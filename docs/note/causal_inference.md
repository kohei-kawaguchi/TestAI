# AIをRAとして活用する：因果推論の実装事例

## はじめに

RAにデータ分析を依頼してから結果を得るまで1週間かかる、コードのバグ修正に何度もやり取りが必要になる——こうした課題は多くの研究者が経験しています。

本リポジトリ「[TestAI](https://github.com/kohei-kawaguchi/TestAI)」では、**経済学のオンデマンドデータ分析作業は完全にAIで代替できる**ことを実証しています。因果推論の最先端手法であるStaggered Difference-in-Differences（DiD）分析をAIに実装させることで、その可能性を検証しました。

## なぜAIで完全代替できるのか

データ分析作業がAI RAに向いている理由は3つあります。まず、やるべきことが数式で明確に書けること。次に、結果を使うのが自分自身なので細かい調整が不要なこと。そして、一度きりの分析なら保守性をあまり気にしなくていいことです。

人間のRAを監督するのと同じように丁寧に指示を出せば、AIは期待通りの成果を出してくれます。しかも反復が速く、複数のタスクを並列実行できるので、研究のスピードが格段に上がります。

## 鍵となる「口頭試問方式」

AIに実装を依頼する前に、必ず行うべきステップがあります。それは**「口頭試問」**です。

いきなり「Staggered DiDを実装してください」と指示しても、AIが手法を正しく理解していない可能性があります。特に経済学の専門用語——均衡、内生性、識別条件など——はAIにとって馴染みの薄い概念です。そこで、人間のRAに口頭試問を行うように、AIにも理解度の確認を行います。

実際の会話例：

- 「パネルデータで時期をずらして介入が入る設定ですが、どのように推定するか知っていますか？」
- AIが「Callaway and Sant'Anna（2021）の手法が使えます」と回答
- 「では、そのRパッケージを見つけて、ヘルプを読んで使い方をまとめてください」
- AIがパッケージのドキュメントを読み込んで説明を返す

この口頭試問プロセスを経て結果を分析プランとして記述させることで、AIが正しい知識基盤を持った状態で実装に取り組むことができます。誤った理解のまま進めると、後の修正が困難になります。

## Staggered DiD実装の実践

本リポジトリでは、Callaway and Sant'Anna（2021）のStaggered DiD手法を実装しました。この手法は、異なる時期に介入を受けるユニットが混在するパネルデータで因果効果を推定する、技術的に複雑な手法です。

[『因果推論の計量経済学』](https://github.com/keisemi/EconometriciansGuide_CausalInference)の差の差法の章から3つのデータセットで検証を行いました：

1. **共変量あり、対照群は一度も介入を受けないユニット**：最も標準的な設定
2. **共変量なし**：`xformla = ~1`という特殊な指定が必要
3. **全ユニットが最終的に介入を受ける**：`control_group = "notyettreated"`と設定を変更する必要

口頭試問で手法の理解を確認した後、AIは3つのケースすべてで適切なコードを生成しました。

## 会話履歴の完全な記録と公開

本リポジトリの重要な特徴は、**AIとの会話履歴の要点を記録して公開している**点です。`docs/conversation/`ディレクトリには、どのような指示を出したか、AIがどう応答したか、どこで口頭試問を行ったかが詳細に記録されています。

これらは単なる記録以上の価値を持っています。どのような質問の仕方がAIの正しい理解を促すか、どの段階で確認を入れるべきかといったノウハウが具体的に示されています。会話履歴とGitのコミット履歴を照らし合わせることで、プロジェクトの進行過程を追跡することができます。

## プロジェクト管理の重要性

AIを効果的に活用するための鍵は、適切なプロジェクト管理にあります。

本リポジトリでは、パッケージ構造のフォルダ管理、Gitバージョン管理、「文書化→実装→検証」というワークフローを採用しています。`R/`ディレクトリには再利用可能な関数、`scripts/analyze_data/`にはAI生成の実装、`scripts/analyze_data_true/`には真実の実装、`docs/`には会話履歴と発表資料を配置しています。

重要な点は、**AIが期待通りに機能しない場合、それはAIの問題ではなく指示の出し方や管理体制の問題である**という認識です。人間のRAと同様に、明確な指示と検証プロセスを提供すれば、AIは期待される成果を出すことができます。

## 今後の展開

今回は「因果推論の実装」というユースケースを示しましたが、経済学研究には多様なタスクが存在します。

今後は以下のようなユースケースも紹介していく予定です：

- **モデルの均衡計算とシミュレーション**：理論モデルの数値解析をAIに実装させる
- **構造推定**：パラメータ推定の実装をAIに依頼する
- **データクリーニング**：データ前処理作業を口頭試問方式で進める

いずれのケースでも、口頭試問方式と会話履歴の記録が重要な役割を果たします。

## まとめ

本リポジトリは、経済学研究におけるオンデマンドデータ分析作業が、適切な管理の下でAIによって完全に代替可能であることを示しています。口頭試問による知識確認、段階的な実装、そして可視化などによる検証プロセスを組み合わせることで、複雑なStaggered DiD分析においても信頼性の高い実装を実現できました。

詳細な会話履歴とスライド資料は`docs/`ディレクトリに、すべてのコードは[GitHubリポジトリ](https://github.com/kohei-kawaguchi/TestAI)で公開しています。
